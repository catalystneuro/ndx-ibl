groups:
- neurodata_type_def: IblSessionData
  neurodata_type_inc: LabMetaData
  name: Ibl_session_data
  doc: IBL sessions metadata
  datasets:
  - name: location
    dtype: text
    doc: location
    quantity: '?'
  - name: project
    dtype: text
    doc: project this session is part of
    quantity: '?'
  - name: type
    dtype: text
    doc: type of session
    quantity: '?'
  - name: number
    dtype: int
    doc: session number
    quantity: '?'
  - name: end_time
    dtype: text
    doc: session end time
    quantity: '?'
  - name: parent_session
    dtype: text
    doc: parent session
    quantity: '?'
  - name: url
    dtype: text
    doc: url of the session metadata
    quantity: '?'
  - name: qc
    dtype: text
    doc: qc
    quantity: '?'
  - name: extended_qc
    dtype: text
    doc: extended_qc
    quantity: '?'
  - name: wateradmin_session_related
    dtype: text
    shape:
    - null
    doc: wateradmin_session_related
    quantity: '?'
  - name: notes
    dtype: text
    shape:
    - null
    doc: notes dictionary from sessions file
    quantity: '?'
  - name: json
    dtype: text
    doc: json
    quantity: '?'
- neurodata_type_def: IblSubject
  neurodata_type_inc: Subject
  name: subject
  doc: IBL mice data
  attributes:
  - name: alive
    dtype: bool
    doc: alive/dead
    required: false
  datasets:
  - name: uuid
    dtype: text
    doc: unique identifier of the subject in Alyx database
    quantity: '?'
  - name: nickname
    dtype: text
    doc: name of the mouse
    quantity: '?'
  - name: url
    dtype: text
    doc: url location of the subject metadata
    quantity: '?'
  - name: responsible_user
    dtype: text
    doc: user in charge of the subject
    quantity: '?'
  - name: death_date
    dtype: text
    doc: date of sacrifice of the mouse
    quantity: '?'
  - name: litter
    dtype: text
    doc: litter of the mouse
    quantity: '?'
  - name: strain
    dtype: text
    doc: strain of mouse
    quantity: '?'
  - name: source
    dtype: text
    doc: source
    quantity: '?'
  - name: line
    dtype: text
    doc: line of this mouse
    quantity: '?'
  - name: projects
    dtype: text
    shape:
    - null
    doc: ibl project involving this mouse
    quantity: '?'
  - name: session_projects
    dtype: text
    shape:
    - null
    doc: session projects
    quantity: '?'
  - name: lab
    dtype: text
    doc: lab
    quantity: '?'
  - name: last_water_restriction
    dtype: text
    doc: last water restriction
    quantity: '?'
  - name: expected_water_ml
    dtype: float
    doc: expected water in milliliters
    quantity: '?'
  - name: remaining_water_ml
    dtype: float
    doc: remaining water in milliliters
    quantity: '?'
  - name: weighings
    dtype: text
    shape:
    - null
    doc: weighings
    quantity: '?'
  - name: water_administrations
    dtype: text
    shape:
    - null
    doc: water_administrations
    quantity: '?'
- neurodata_type_def: IblProbes
  neurodata_type_inc: Device
  doc: Neuro Pixels probes
  datasets:
  - name: id
    dtype: text
    doc: id
    quantity: '?'
  - name: model
    dtype: text
    doc: model
    quantity: '?'
  - name: trajectory_estimate
    dtype: text
    shape:
    - null
    doc: dict containing trajectory info for each probe
    quantity: '?'
- neurodata_type_def: IblProbeInsertionTrajectoryTable
  neurodata_type_inc: DynamicTable
  doc: 'Probe insertion trajectory parameters for a single probe. Each row represents
    a trajectory estimate from a different provenance level, progressing from theoretical
    to validated: Planned (pre-surgical target), Micro-manipulator (recorded during
    surgery), Histology track (traced from post-mortem brain slices), and Ephys aligned
    histology track (histology refined using electrophysiology). Insertion point coordinates
    (ml, ap, dv) are bregma-centered with units in micrometers: ml is medio-lateral
    (positive=right), ap is anterior-posterior (positive=anterior), dv is dorso-ventral
    (positive=dorsal). Angles characterize the spatial orientation of the probe: theta
    is polar angle from vertical (0=straight down into brain, 90=horizontal), phi
    is azimuth angle from the AP axis (0=tilted anteriorly, 90=tilted left, 180=posteriorly),
    roll defines the electrode-facing direction (rotation around probe axis). Depth
    is the insertion distance along the probe axis from the brain surface entry point
    to the probe tip.'
  datasets:
  - name: device
    neurodata_type_inc: VectorData
    dtype:
      target_type: Device
      reftype: object
    doc: Reference to the Device object (e.g., NeuropixelsProbe) being 
      localized. This links the trajectory to the actual probe device in the NWB
      file.
  - name: pid
    neurodata_type_inc: VectorData
    dtype: text
    doc: Probe insertion UUID from Alyx database. This unique identifier links 
      the trajectory to the specific probe insertion record in the IBL database,
      enabling traceability of all probe-related metadata and quality control 
      information.
    quantity: '?'
  - name: trajectory_source
    neurodata_type_inc: VectorData
    dtype: text
    doc: "Source of this trajectory estimate, representing increasing confidence and
      validation: 'Planned' (pre-surgical target coordinates from experimental design),
      'Micro-manipulator' (coordinates recorded from stereotaxic manipulator during
      surgery), 'Histology track' (traced from post-mortem brain slices by fitting
      a line through manually picked points), 'Ephys aligned histology track' (histology
      refined by aligning detected unit depths with the histology trace)."
    quantity: '?'
  - name: ml
    neurodata_type_inc: VectorData
    dtype: float
    doc: Insertion point medio-lateral coordinate in micrometers, 
      bregma-centered. Positive values are right of midline, negative are left. 
      This is where the probe enters the brain surface. For histology-derived 
      trajectories, computed from the intersection of the fitted probe track 
      with brain surface.
  - name: ap
    neurodata_type_inc: VectorData
    dtype: float
    doc: Insertion point anterior-posterior coordinate in micrometers, 
      bregma-centered. Positive values are anterior to bregma, negative are 
      posterior. This is where the probe enters the brain surface. For 
      histology-derived trajectories, computed from the intersection of the 
      fitted probe track with brain surface.
  - name: dv
    neurodata_type_inc: VectorData
    dtype: float
    doc: Insertion point dorso-ventral coordinate in micrometers, 
      bregma-centered. Typically negative values (brain surface is below bregma 
      skull landmark level). Values vary with AP position due to brain surface 
      curvature. This is where the probe enters the brain surface. For 
      histology-derived trajectories, computed from the intersection of the 
      fitted probe track with brain surface.
  - name: depth_um
    neurodata_type_inc: VectorData
    dtype: float
    doc: Insertion depth in micrometers, measured along the probe axis from the 
      brain surface insertion point to the probe tip. This indicates how far the
      probe travels into the brain. For histology-derived trajectories, computed
      as the Euclidean distance between entry point and the deepest traced point
      projected onto the fitted trajectory line.
  - name: theta
    neurodata_type_inc: VectorData
    dtype: float
    doc: 'Polar angle in degrees measuring probe tilt from vertical. 0 degrees means
      the probe is inserted straight down into the brain (along DV axis), 90 degrees
      means horizontal. For histology-derived trajectories, computed using spherical
      coordinates: theta = arccos(dz/depth) where dz is the vertical component of
      the entry-to-tip vector.'
  - name: phi
    neurodata_type_inc: VectorData
    dtype: float
    doc: 'Azimuth angle in degrees defining the direction of probe tilt in the horizontal
      plane. Measured counter-clockwise from the positive AP axis when viewed from
      above: 0 = tilted anteriorly, 90 = tilted left, 180 = tilted posteriorly, 270
      = tilted right. For histology-derived trajectories, computed using spherical
      coordinates: phi = arctan2(dy, dx).'
  - name: roll
    neurodata_type_inc: VectorData
    dtype: float
    doc: Probe rotation around its own longitudinal axis in degrees. Determines 
      which direction the electrode sites face. A value of 0 typically indicates
      electrodes facing anterior.
    quantity: '?'
- neurodata_type_def: IblProbeInsertionTrajectories
  neurodata_type_inc: LabMetaData
  name: ibl_probe_insertion_trajectories
  doc: Container for IBL probe insertion trajectory information stored as lab 
    metadata. Contains one IblProbeInsertionTrajectoryTable per probe, with 
    insertion geometry parameters. Each table is named after the probe (e.g., 
    "Probe00", "Probe01").
  groups:
  - neurodata_type_inc: IblProbeInsertionTrajectoryTable
    doc: Table of probe insertion trajectory parameters for a single probe
    quantity: '*'
